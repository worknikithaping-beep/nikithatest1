<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="https://glitch.com/favicon.ico" />
    <title>Widget Flow in Test</title>
    <script
      type="text/javascript"
      src="https://assets.test-one-pingone.com/davinci/latest/davinci.js"
    ></script>

    <script>
      function loadwidget(flowParameters) {
        const flowURL = "https://auth.test-one-pingone.com";
        const tokenURL = "https://orchestrate-api.test-one-pingone.com";
        const companyId = "587f10e3-4cb2-460f-90d5-8f7164298cfc";
        const skApiKey =
          "5de0d1060486e3de75ae9f2bcb78dc90fb81df1232ff6a7877970c1ce9b579875552084955fd58e7e937b6078d4b473e92bff3780139fa406d0cd241ff101825abffb4ae6ab2bf3c42a10f32ecb5459046166536154ddf1b4d91c8ec356aa3e04108ce916d12f6a7bfc353b0bda606726a72eaa8c16f59719e53218f462f4e9b";
        const policyId = "b65c61c415f4507d2a59262f5e3d2e3e";

        const skGetTokenUrl =
          tokenURL + "/v1/company/" + companyId + "/sdktoken";

        var headers = new Headers();
        headers.append("X-SK-API-KEY", skApiKey);
        var requestOptions = {
          method: "GET",
          headers: headers,
          redirect: "follow",
        };

        fetch(skGetTokenUrl, requestOptions)
          .then((response) => response.json())
          .then((responseData) => {
            var props = {
              config: {
                method: "runFlow",
                apiRoot: flowURL,
                accessToken: responseData.access_token,
                companyId: companyId,
                policyId: policyId
              },
              useModal: false,
              successCallback,
              errorCallback,
              onCloseModal,
            };
            //console.log(props);
            davinci.skRenderScreen(document.getElementById("widget"), props);
          })
          .catch((error) => console.log("error", error));

        function successCallback(response) {
           const accessToken = response.access_token;
        const sessionToken = response.sessionToken;
        const sessionTokenMaxAge = response.sessionTokenMaxAge;
        //document.getElementById("tokens").innerHTML = `<h3>Access Token</h3><br>${accessToken}<br><h3>Session Token</h3><br>${sessionToken}`;
          //window.location = "index.html";
        }

        function errorCallback(error) {
          console.log(error);
          //window.location = "index.html";
        }

        function onCloseModal() {
          console.log("onCloseModal");
        }
      }
    </script>
  </head>
  <body onload="loadwidget()">
    <!--************************-->
    <!--  ADD LINK TO CSS HERE  -->
    <link rel="stylesheet" href="." />
    <!--************************-->
    <div class="background">
      <div class="shape"></div>
      <div class="shape"></div>
    </div>
    <!--  DISPLAY WIDGET  -->
    <div id="widget" class="skWidget widget"></div>
  </body>
</html>
