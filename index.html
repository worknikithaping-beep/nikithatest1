<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="https://glitch.com/favicon.ico" />
    <title>Widget Flow in Test</title>
    <script
      type="text/javascript"
      src="https://assets.ort-one-pingone.com/davinci/latest/davinci.js"
    ></script>

    <script>
      function loadwidget(flowParameters) {
        const flowURL = "https://auth.ort-one-pingone.com";
        const tokenURL = "https://orchestrate-api.ort-one-pingone.com";
        const companyId = "a1efb15a-4a8c-476f-b165-b060b4cf7d20";
        const skApiKey =
          "39f1893cb501538709fe58d0216bff7845afcd16e0d0b08696dee56a15513abe2981b3d1c2e4a9bb280e4d7569290be748df89f8ac59cd38ba7a32b090d2d0db2f362e58d10041e950427514d080d30822f040e0d83e5be2c55de5bb5741afe99ced2a859e89abc020492ae51dd68a51f465cee57afcabab38b1710550d8bf78";
        const policyId = "9a0ee234dcf13fb197fbd5141b222a40";

        const skGetTokenUrl =
          tokenURL + "/v1/company/" + companyId + "/sdktoken";

        var headers = new Headers();
        headers.append("X-SK-API-KEY", skApiKey);
        var requestOptions = {
          method: "GET",
          headers: headers,
          redirect: "follow",
        };

        fetch(skGetTokenUrl, requestOptions)
          .then((response) => response.json())
          .then((responseData) => {
            var props = {
              config: {
                method: "runFlow",
                apiRoot: flowURL,
                accessToken: responseData.access_token,
                companyId: companyId,
                policyId: policyId
              },
              useModal: false,
              successCallback,
              errorCallback,
              onCloseModal,
            };
            //console.log(props);
            davinci.skRenderScreen(document.getElementById("widget"), props);
          })
          .catch((error) => console.log("error", error));

        function successCallback(response) {
           const accessToken = response.access_token;
        const sessionToken = response.sessionToken;
        const sessionTokenMaxAge = response.sessionTokenMaxAge;
        //document.getElementById("tokens").innerHTML = `<h3>Access Token</h3><br>${accessToken}<br><h3>Session Token</h3><br>${sessionToken}`;
          //window.location = "index.html";
        }

        function errorCallback(error) {
          console.log(error);
          //window.location = "index.html";
        }

        function onCloseModal() {
          console.log("onCloseModal");
        }
      }
    </script>
  </head>
  <body onload="loadwidget()">
    <!--************************-->
    <!--  ADD LINK TO CSS HERE  -->
    <link rel="stylesheet" href="." />
    <!--************************-->
    <div class="background">
      <div class="shape"></div>
      <div class="shape"></div>
    </div>
    <!--  DISPLAY WIDGET  -->
    <div id="widget" class="skWidget widget"></div>
  </body>
</html>
