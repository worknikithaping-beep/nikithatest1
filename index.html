<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="https://glitch.com/favicon.ico" />
    <title>Widget Flow in Test</title>
    <script
      type="text/javascript"
      src="https://assets.test-one-pingone.com/davinci/latest/davinci.js"
    ></script>

    <script>
      function loadwidget(flowParameters) {
        const flowURL = "https://auth.test-one-pingone.com";
        const tokenURL = "https://orchestrate-api.test-one-pingone.com";
        const companyId = "a1efb15a-4a8c-476f-b165-b060b4cf7d20";
        const skApiKey =
          "b0f8946436eb6c49ccedb6b9ccd8cc6cf87d768be0e770ea847ccb10ca07ac455a8521ada0601b10e98664eb3f1ac2833ec1d52df07246cb2801ae589b77752354cff2b3d5666c3769fbafaf1693f490227b87a4c459bc6f04196b5306656111a9e011bccf7d3aacbccdbf37e39531236d199a2e04029d5382b37baa8ee6ff97";
        const policyId = "9a0ee234dcf13fb197fbd5141b222a40";

        const skGetTokenUrl =
          tokenURL + "/v1/company/" + companyId + "/sdktoken";

        var headers = new Headers();
        headers.append("X-SK-API-KEY", skApiKey);
        var requestOptions = {
          method: "GET",
          headers: headers,
          redirect: "follow",
        };

        fetch(skGetTokenUrl, requestOptions)
          .then((response) => response.json())
          .then((responseData) => {
            var props = {
              config: {
                method: "runFlow",
                apiRoot: flowURL,
                accessToken: responseData.access_token,
                companyId: companyId,
                policyId: policyId
              },
              useModal: false,
              successCallback,
              errorCallback,
              onCloseModal,
            };
            //console.log(props);
            davinci.skRenderScreen(document.getElementById("widget"), props);
          })
          .catch((error) => console.log("error", error));

        function successCallback(response) {
           const accessToken = response.access_token;
        const sessionToken = response.sessionToken;
        const sessionTokenMaxAge = response.sessionTokenMaxAge;
        //document.getElementById("tokens").innerHTML = `<h3>Access Token</h3><br>${accessToken}<br><h3>Session Token</h3><br>${sessionToken}`;
          //window.location = "index.html";
        }

        function errorCallback(error) {
          console.log(error);
          //window.location = "index.html";
        }

        function onCloseModal() {
          console.log("onCloseModal");
        }
      }
    </script>
  </head>
  <body onload="loadwidget()">
    <!--************************-->
    <!--  ADD LINK TO CSS HERE  -->
    <link rel="stylesheet" href="." />
    <!--************************-->
    <div class="background">
      <div class="shape"></div>
      <div class="shape"></div>
    </div>
    <!--  DISPLAY WIDGET  -->
    <div id="widget" class="skWidget widget"></div>
  </body>
</html>
