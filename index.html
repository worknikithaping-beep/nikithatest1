<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="https://glitch.com/favicon.ico" />
    <title>Widget Flow</title>
    <script
      type="text/javascript"
      src="https://assets.test-one-pingone.com/davinci/latest/davinci.js"
    ></script>

    <script>
      function loadwidget(flowParameters) {
        const flowURL = "https://auth.test-one-pingone.com";
        const tokenURL = "https://orchestrate-api.test-one-pingone.com";
        const companyId = "587f10e3-4cb2-460f-90d5-8f7164298cfc";
        const skApiKey =
          "caa6151934274b25a965df74afe9640ed1a61387d426cc3131454c8480a223f5bb8ea7324573b3c1c4dd252620d9272d897210644028ed075280bc35a73575c67f886784b33b7d46541aed3873a3b81170566bb518c5d68b0aea761a8ac227748a2cd50e4863c37bbe6092c536ec0b69e0fbd49294c621114d2f7b8896275ab0";
        const policyId = "b65c61c415f4507d2a59262f5e3d2e3e";

        const skGetTokenUrl =
          tokenURL + "/v1/company/" + companyId + "/sdktoken";

        var headers = new Headers();
        headers.append("X-SK-API-KEY", skApiKey);
        var requestOptions = {
          method: "GET",
          headers: headers,
          redirect: "follow",
        };

        fetch(skGetTokenUrl, requestOptions)
          .then((response) => response.json())
          .then((responseData) => {
            var props = {
              config: {
                method: "runFlow",
                apiRoot: flowURL,
                accessToken: responseData.access_token,
                companyId: companyId,
                policyId: policyId
              },
              useModal: false,
              successCallback,
              errorCallback,
              onCloseModal,
            };
            //console.log(props);
            davinci.skRenderScreen(document.getElementById("widget"), props);
          })
          .catch((error) => console.log("error", error));

        function successCallback(response) {
           const accessToken = response.access_token;
        const sessionToken = response.sessionToken;
        const sessionTokenMaxAge = response.sessionTokenMaxAge;
        //document.getElementById("tokens").innerHTML = `<h3>Access Token</h3><br>${accessToken}<br><h3>Session Token</h3><br>${sessionToken}`;
          //window.location = "index.html";
        }

        function errorCallback(error) {
          console.log(error);
          //window.location = "index.html";
        }

        function onCloseModal() {
          console.log("onCloseModal");
        }
      }
    </script>
  </head>
  <body onload="loadwidget()">
    <!--************************-->
    <!--  ADD LINK TO CSS HERE  -->
    <link rel="stylesheet" href="." />
    <!--************************-->
    <div class="background">
      <div class="shape"></div>
      <div class="shape"></div>
    </div>
    <!--  DISPLAY WIDGET  -->
    <div id="widget" class="skWidget widget"></div>
  </body>
</html>
