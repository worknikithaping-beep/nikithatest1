<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="https://glitch.com/favicon.ico" />
    <title>Widget Flow in Test</title>
    <script
      type="text/javascript"
      src="https://assets.test-one-pingone.com/davinci/latest/davinci.js"
    ></script>

    <script>
      function loadwidget(flowParameters) {
        const flowURL = "https://auth.test-one-pingone.com";
        const tokenURL = "https://orchestrate-api.test-one-pingone.com";
        const companyId = "587f10e3-4cb2-460f-90d5-8f7164298cfc";
        const skApiKey =
          "67cecb7f0e225995ffc3159d056c22b6811be5171167504b90405fcdab2a3e25c0178fc1f5c92d1f2208a00aa56501e4368e4b92058261ec6f7bb0bc81c20483b4f1790bddf299f1836e95d1d98d52fd8306e24f97037872a74049989c9dd847e80c26443d25bbc2cfc7ea9f080a81b1c9bf7fb28b6a3bd59f85f8733c453122";
        const policyId = "b65c61c415f4507d2a59262f5e3d2e3e";

        const skGetTokenUrl =
          tokenURL + "/v1/company/" + companyId + "/sdktoken";

        var headers = new Headers();
        headers.append("X-SK-API-KEY", skApiKey);
        var requestOptions = {
          method: "GET",
          headers: headers,
          redirect: "follow",
        };

        fetch(skGetTokenUrl, requestOptions)
          .then((response) => response.json())
          .then((responseData) => {
            var props = {
              config: {
                method: "runFlow",
                apiRoot: flowURL,
                accessToken: responseData.access_token,
                companyId: companyId,
                policyId: policyId
              },
              useModal: false,
              successCallback,
              errorCallback,
              onCloseModal,
            };
            //console.log(props);
            davinci.skRenderScreen(document.getElementById("widget"), props);
          })
          .catch((error) => console.log("error", error));

        function successCallback(response) {
           const accessToken = response.access_token;
        const sessionToken = response.sessionToken;
        const sessionTokenMaxAge = response.sessionTokenMaxAge;
        //document.getElementById("tokens").innerHTML = `<h3>Access Token</h3><br>${accessToken}<br><h3>Session Token</h3><br>${sessionToken}`;
          //window.location = "index.html";
        }

        function errorCallback(error) {
          console.log(error);
          //window.location = "index.html";
        }

        function onCloseModal() {
          console.log("onCloseModal");
        }
      }
    </script>
  </head>
  <body onload="loadwidget()">
    <!--************************-->
    <!--  ADD LINK TO CSS HERE  -->
    <link rel="stylesheet" href="." />
    <!--************************-->
    <div class="background">
      <div class="shape"></div>
      <div class="shape"></div>
    </div>
    <!--  DISPLAY WIDGET  -->
    <div id="widget" class="skWidget widget"></div>
  </body>
</html>
